#include "crow.h"
#include "requests.hpp"
#include "algorithms.hpp"

void setup_routes(crow::SimpleApp& app) {
    CROW_ROUTE(app, "/")([](){
        return "Hello world";
    });

    CROW_ROUTE(app, "/map-match/<string>")([](const std::string& points){
        return map_match(points);
    });
}

int main()
{
    // std::cout << convert_completeGeoJSON_to_simpleGeoJSON("\"coordinates\":[[-8.598169,41.167126],[-8.598199,41.167062],[-8.598105,41.167032],[-8.597293,41.166804],[-8.597429,41.166511],[-8.597553,41.166219],[-8.59758,41.166186],[-8.59773,41.166003],[-8.597846,41.165966],[-8.598013,41.165913],[-8.598303,41.165809],[-8.598418,41.165748],[-8.598446,41.165733],[-8.59852,41.165702],[-8.598592,41.165581],[-8.598606,41.165546],[-8.59866,41.165428],[-8.598553,41.165416],[-8.598394,41.165402],[-8.59748,41.165269],[-8.595775,41.165045],[-8.595742,41.165041],[-8.5957,41.165035],[-8.595659,41.16506],[-8.595638,41.165096],[-8.595639,41.165137],[-8.595666,41.165159],[-8.595712,41.165164],[-8.595744,41.165169],[-8.596905,41.165323],[-8.597453,41.165396],[-8.59748,41.165269],[-8.597462,41.165237],[-8.597459,41.165221],[-8.597457,41.165207],[-8.597519,41.164912],[-8.597638,41.164313],[-8.597653,41.164241],[-8.597704,41.163931],[-8.597732,41.163783],[-8.597742,41.163731],[-8.597754,41.163669],[-8.597787,41.163516],[-8.59789,41.163042],[-8.598011,41.162459],[-8.598049,41.162192],[-8.598078,41.162008],[-8.598099,41.161912],[-8.598232,41.161217],[-8.59824,41.161174],[-8.598253,41.161103],[-8.598272,41.160996],[-8.598315,41.160748],[-8.598543,41.15953],[-8.598551,41.15947],[-8.598578,41.159306],[-8.598621,41.159064],[-8.598629,41.159019],[-8.598668,41.158811],[-8.598688,41.158703],[-8.598815,41.158016],[-8.598743,41.158008],[-8.598232,41.157948],[-8.598136,41.157919],[-8.597114,41.157066],[-8.59669,41.156734],[-8.596314,41.156421],[-8.595686,41.1559],[-8.595269,41.15555],[-8.595229,41.155517],[-8.595147,41.155448],[-8.595091,41.155556],[-8.595024,41.155673],[-8.594975,41.155764],[-8.594928,41.155851],[-8.594902,41.155898],[-8.594882,41.155934],[-8.594753,41.156147],[-8.594711,41.156214],[-8.594683,41.156262],[-8.594631,41.156348],[-8.594602,41.156398],[-8.594491,41.156594],[-8.594463,41.156641],[-8.594543,41.156695],[-8.595679,41.157463],[-8.595984,41.15768],[-8.596461,41.157998],[-8.59693,41.158309],[-8.597791,41.158881],[-8.597906,41.158969],[-8.597939,41.158993],[-8.598052,41.159073],[-8.598125,41.159075],[-8.598196,41.159072],[-8.598251,41.159064],[-8.598308,41.159051],[-8.598476,41.158976],[-8.598521,41.158956],[-8.598543,41.158944],[-8.598564,41.15893],[-8.598602,41.158896],[-8.598634,41.158856],[-8.598668,41.158811],[-8.598688,41.158703],[-8.598815,41.158016],[-8.598905,41.157601],[-8.59892,41.157528],[-8.599044,41.156895],[-8.599059,41.156822],[-8.59931,41.155455],[-8.599468,41.154583],[-8.599478,41.15453],[-8.599682,41.153459],[-8.599692,41.153416],[-8.599715,41.153293],[-8.599732,41.15318],[-8.599977,41.151845],[-8.599986,41.151799],[-8.600005,41.151692],[-8.600033,41.151556],[-8.60011,41.151188],[-8.600119,41.151143],[-8.600131,41.151085],[-8.60021,41.151079],[-8.600317,41.151072],[-8.600478,41.151064],[-8.601171,41.151047],[-8.601247,41.151045],[-8.602094,41.151016],[-8.602138,41.151015],[-8.60223,41.15101],[-8.602371,41.151005],[-8.603664,41.150967],[-8.603749,41.150964],[-8.604197,41.150946],[-8.60425,41.150945],[-8.604809,41.15095],[-8.605269,41.150956],[-8.605365,41.150957],[-8.605782,41.150968],[-8.606219,41.150975],[-8.606508,41.15098],[-8.606543,41.150981],[-8.606551,41.15098],[-8.606722,41.15096],[-8.606773,41.15086],[-8.606791,41.150825],[-8.606868,41.150683],[-8.607095,41.150261],[-8.607128,41.150199],[-8.607181,41.150101],[-8.60724,41.149984],[-8.607247,41.149969],[-8.607335,41.149793],[-8.607798,41.148888],[-8.607825,41.148836],[-8.607862,41.148761],[-8.607892,41.148705],[-8.607906,41.148679],[-8.607999,41.148502],[-8.608135,41.148274],[-8.608187,41.148188],[-8.608333,41.147947],[-8.608418,41.147804],[-8.608437,41.147773],[-8.608607,41.147492],[-8.608648,41.147423],[-8.608664,41.147397],[-8.608811,41.147429],[-8.609278,41.147527],[-8.609353,41.147542],[-8.609425,41.147556],[-8.610725,41.147805],[-8.610786,41.147815],[-8.610942,41.147843],[-8.611063,41.14786],[-8.611113,41.147867],[-8.611286,41.147888],[-8.611384,41.147896],[-8.611481,41.147903],[-8.612017,41.147941],[-8.612081,41.147946],[-8.612159,41.147952],[-8.612275,41.14797],[-8.612374,41.147987],[-8.612688,41.148065],[-8.61299,41.148141],[-8.613085,41.148147],[-8.613141,41.148151],[-8.613128,41.148277],[-8.613167,41.14828],[-8.614064,41.148348],[-8.614116,41.148352],[-8.614178,41.148356],[-8.614242,41.148354],[-8.614291,41.148344],[-8.614333,41.148329],[-8.614372,41.148301],[-8.614397,41.14826],[-8.614414,41.148199],[-8.614506,41.147865],[-8.614553,41.147786],[-8.614618,41.147677],[-8.614879,41.147351],[-8.614896,41.14733],[-8.614955,41.147256],[-8.614996,41.147224],[-8.615045,41.147204],[-8.615112,41.147195],[-8.615149,41.147197],[-8.615239,41.147213],[-8.615291,41.14722],[-8.615335,41.147225],[-8.615903,41.147293],[-8.615935,41.147295],[-8.615972,41.147295],[-8.616053,41.147276],[-8.61613,41.147213],[-8.616215,41.147179],[-8.616389,41.14718],[-8.616507,41.147194],[-8.616588,41.147203],[-8.616634,41.147208],[-8.617035,41.147255],[-8.617105,41.147254],[-8.617196,41.147246],[-8.61721,41.147244],[-8.61724,41.147241],[-8.617405,41.147225],[-8.617481,41.147218],[-8.617735,41.147198],[-8.617792,41.147193],[-8.617887,41.147184],[-8.618079,41.147943],[-8.618106,41.148051],[-8.618108,41.148067],[-8.61807,41.148159],[-8.617995,41.148333],[-8.617972,41.148411],[-8.61797,41.148425],[-8.617867,41.148697],[-8.617807,41.14869],[-8.617791,41.148688],[-8.617429,41.148654],[-8.61742,41.148782],[-8.617411,41.148796],[-8.617388,41.148803],[-8.617336,41.148808],[-8.617307,41.148821],[-8.617286,41.148844],[-8.617277,41.148873],[-8.617305,41.149046],[-8.61732,41.149054],[-8.617358,41.149055],[-8.617372,41.149059],[-8.617377,41.149075],[-8.617374,41.149166],[-8.617374,41.149166],[-8.617377,41.149075],[-8.617372,41.149059],[-8.617358,41.149055],[-8.61732,41.149054],[-8.617305,41.149046],[-8.617277,41.148873],[-8.617286,41.148844],[-8.617307,41.148821],[-8.617336,41.148808],[-8.617388,41.148803],[-8.617411,41.148796],[-8.61742,41.148782],[-8.617429,41.148654],[-8.617791,41.148688],[-8.617807,41.14869],[-8.617867,41.148697],[-8.617756,41.148994],[-8.617705,41.149109],[-8.617694,41.149124],[-8.617671,41.149139],[-8.617542,41.149172],[-8.617771,41.150066],[-8.618561,41.149955],[-8.620728,41.149663],[-8.62078,41.149656],[-8.620875,41.149643],[-8.620862,41.14958],[-8.620854,41.149539],[-8.620684,41.148709],[-8.619618,41.148353],[-8.62002,41.147867],[-8.620055,41.147826],[-8.620095,41.147779],[-8.620134,41.14773],[-8.620204,41.147626],[-8.62031,41.147503],[-8.620351,41.14745],[-8.6204,41.147346],[-8.62042,41.14722],[-8.620408,41.147165],[-8.620375,41.146923],[-8.620368,41.146881],[-8.620228,41.146286],[-8.620223,41.146261],[-8.620191,41.146093],[-8.620184,41.146056],[-8.620182,41.146031],[-8.619902,41.146074],[-8.619868,41.14608],[-8.619639,41.14611],[-8.619552,41.146121],[-8.619194,41.146169],[-8.617861,41.146349],[-8.617818,41.146354],[-8.617693,41.146368],[-8.61768,41.146314],[-8.61736,41.145019],[-8.61735,41.144977],[-8.617341,41.144946],[-8.617296,41.144905],[-8.617241,41.144859],[-8.617176,41.144826],[-8.617085,41.144808],[-8.616978,41.144813],[-8.616917,41.144827],[-8.616863,41.14485],[-8.616641,41.144958],[-8.615728,41.145399],[-8.615693,41.145415],[-8.615631,41.145446],[-8.615541,41.145491],[-8.615342,41.145573],[-8.615329,41.145578],[-8.615137,41.145656],[-8.614811,41.145772],[-8.614765,41.145788],[-8.614497,41.145873],[-8.614172,41.145962],[-8.614021,41.145995],[-8.613974,41.146006],[-8.613873,41.146029],[-8.61383,41.146031],[-8.613773,41.146018],[-8.613627,41.145944],[-8.613544,41.145891],[-8.61346,41.145874],[-8.61342,41.145877],[-8.61338,41.14588],[-8.612486,41.145967],[-8.612439,41.145972],[-8.612235,41.14599],[-8.611633,41.146043],[-8.611465,41.146048],[-8.611315,41.146053],[-8.611034,41.146061],[-8.610969,41.146062],[-8.610886,41.146043],[-8.610866,41.146018],[-8.610832,41.14584],[-8.610834,41.145826],[-8.610903,41.145365],[-8.610908,41.145334],[-8.61092,41.145263],[-8.610934,41.145198],[-8.611119,41.145059],[-8.611145,41.145041],[-8.611181,41.145012],[-8.611487,41.144764],[-8.611591,41.144683],[-8.611927,41.144432],[-8.612137,41.144265],[-8.612201,41.144218],[-8.612526,41.143975],[-8.613143,41.14353]]") << std::endl;

    // std::cout << convert_completeGeoJSON_to_simpleGeoJSON("\"coordinates\":[[-8.598873,41.167066],[-8.601308,41.16715],[-8.601492,41.167148],[-8.601526,41.167095],[-8.601738,41.166767],[-8.60288,41.167455],[-8.603475,41.167798],[-8.603472,41.166722],[-8.603461,41.166633],[-8.603388,41.166516],[-8.603319,41.166401],[-8.602741,41.16549],[-8.602733,41.165477],[-8.602781,41.165465],[-8.60284,41.165459],[-8.603556,41.165444],[-8.605397,41.16542],[-8.606234,41.165409],[-8.606358,41.165408],[-8.606435,41.166257],[-8.60646,41.166271],[-8.606475,41.166291],[-8.606484,41.16633],[-8.606488,41.166363],[-8.606503,41.166419],[-8.606529,41.166441],[-8.606546,41.166448]]") << std::endl;

    crow::SimpleApp app;

    setup_routes(app);

    app.port(18080).multithreaded().run();

    return 0;
}
